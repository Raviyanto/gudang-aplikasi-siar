<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Siar Hacker Navigator V3</title>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <style>
        :root { --neon: #39ff14; --bg: #000; --dim: rgba(57, 255, 20, 0.1); }
        body { 
            background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; 
            margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        /* Nav Bar Atas - Ramping */
        .top-bar { 
            display: flex; gap: 15px; padding: 10px 20px; background: #050505;
            border-bottom: 2px solid var(--neon); align-items: center; z-index: 100;
        }

        .btn { 
            background: none; border: 1px solid var(--neon); color: var(--neon); 
            padding: 8px 12px; cursor: pointer; font-family: inherit; font-weight: bold;
            display: flex; align-items: center; gap: 5px;
        }
        .btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 10px var(--neon); }

        input#urlInput { 
            flex: 1; background: #111; border: 1px solid var(--neon); 
            color: var(--neon); padding: 10px; outline: none; border-radius: 4px;
        }

        /* Container Utama */
        .viewport { flex: 1; position: relative; background: #000; }
        
        iframe#webFrame { width: 100%; height: 100%; border: none; background: #fff; display: block; }

        /* Tampilan Berkas Full Page */
        #file-manager { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; display: none; flex-direction: column; padding: 20px; box-sizing: border-box;
            overflow-y: auto;
        }

        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .file-card { 
            border: 1px solid var(--dim); padding: 15px; text-align: center; cursor: pointer; 
            transition: 0.2s; background: rgba(0,20,0,0.3);
        }
        .file-card:hover { border-color: var(--neon); background: var(--dim); }
        .file-icon { font-size: 2.5rem; margin-bottom: 10px; display: block; }

        /* Editor Overlay */
        #editor-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 200; display: none; flex-direction: column; padding: 30px; box-sizing: border-box;
        }
        textarea { 
            flex: 1; background: #0a0a0a; color: var(--neon); border: 1px solid var(--neon); 
            padding: 20px; font-family: inherit; font-size: 1.2rem; outline: none;
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="btn" onclick="tampilGoogle()">üè† HOME</button>
        
        <input type="text" id="urlInput" placeholder=">> CARI GOOGLE / MASUKKAN URL..." onkeydown="if(event.key==='Enter') navigasiWeb()">
        
        <button class="btn" onclick="tampilFileManager()">üìÅ BERKAS</button>

        <button class="btn" style="border-color:#f33; color:#f33" onclick="keluar()">KELUAR</button>
    </div>

    <div class="viewport">
        <iframe id="webFrame" src="https://www.google.com/search?igu=1"></iframe>

        <div id="file-manager">
            <h2 style="border-bottom: 1px solid var(--neon); padding-bottom: 10px;">üìÇ PENJELAJAH_BERKAS</h2>
            <div id="file-list" class="file-grid">
                </div>
        </div>
    </div>

    <div id="editor-overlay">
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
            <h3 id="edit-title" style="margin:0">EDITING: -</h3>
            <div style="display: flex; gap: 10px;">
                <button class="btn" style="background: var(--neon); color:#000" onclick="simpanEdit()">üíæ SIMPAN</button>
                <button class="btn" onclick="tutupEditor()">TUTUP</button>
            </div>
        </div>
        <textarea id="text-editor"></textarea>
    </div>

    

    <script>
        let saraf, toko, currentPath = "Dokumen/Siar_Catatan", editingFile = "";

        new QWebChannel(qt.webChannelTransport, function(channel) {
            saraf = channel.objects.berkasSaraf;
            toko = channel.objects.tokoManager;
            muatBerkas();
        });

        function tampilGoogle() {
            document.getElementById('file-manager').style.display = 'none';
            document.getElementById('webFrame').style.display = 'block';
            document.getElementById('webFrame').src = "https://www.google.com/search?igu=1";
        }

        function navigasiWeb() {
            let q = document.getElementById('urlInput').value;
            if(!q) return;
            let url = q.includes('.') ? (q.startsWith('http') ? q : 'https://'+q) : 'https://www.google.com/search?q='+encodeURIComponent(q);
            
            // Gunakan navigasi langsung dari otak.py
            toko.navigasi_langsung(url);
        }

        function tampilFileManager() {
            document.getElementById('webFrame').style.display = 'none';
            document.getElementById('file-manager').style.display = 'flex';
            muatBerkas();
        }

        function muatBerkas() {
            saraf.telusuri_folder(currentPath, function(items) {
                const list = document.getElementById('file-list');
                list.innerHTML = "";
                items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = "file-card";
                    const ikon = item.tipe === 'folder' ? 'üìÅ' : 'üìÑ';
                    card.innerHTML = `<span class="file-icon">${ikon}</span><span>${item.nama}</span>`;
                    card.onclick = () => {
                        if(item.tipe === 'berkas') bukaEditor(item.path_relatif);
                    };
                    list.appendChild(card);
                });
            });
        }

        function bukaEditor(path) {
            editingFile = path;
            saraf.baca_isi_berkas(path, function(isi) {
                document.getElementById('edit-title').innerText = "EDIT: " + path.split('/').pop();
                document.getElementById('text-editor').value = isi;
                document.getElementById('editor-overlay').style.display = 'flex';
            });
        }

        function simpanEdit() {
            const konten = document.getElementById('text-editor').value;
            saraf.simpan_isi_berkas(editingFile, konten, function(sukses) {
                if(sukses) {
                    alert("Berhasil disimpan!");
                    tutupEditor();
                }
            });
        }

        function tutupEditor() { document.getElementById('editor-overlay').style.display = 'none'; }
        function keluar() { toko.buka_aplikasi_siar('dashboard'); }
    </script>
</body>
</html>
