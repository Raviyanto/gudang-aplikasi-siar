<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Siar Hacker Navigator V4</title>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <style>
        :root { --neon: #39ff14; --bg: #000; --dim: rgba(57, 255, 20, 0.1); }
        body { 
            background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; 
            margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
            background-image: radial-gradient(var(--dim) 1px, transparent 1px); background-size: 30px 30px;
        }

        /* Top Bar Navigasi */
        .top-bar { 
            display: flex; gap: 15px; padding: 15px 25px; background: #050505;
            border-bottom: 2px solid var(--neon); align-items: center;
        }

        .btn { 
            background: none; border: 1px solid var(--neon); color: var(--neon); 
            padding: 10px 18px; cursor: pointer; font-family: inherit; font-weight: bold;
        }
        .btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 10px var(--neon); }

        input#urlInput { 
            flex: 1; background: #0a0a0a; border: 1px solid var(--neon); 
            color: var(--neon); padding: 10px; outline: none;
        }

        /* Area Utama (Hanya untuk File Manager & Editor) */
        .viewport { flex: 1; padding: 30px; overflow-y: auto; }
        
        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 20px; }
        .file-card { 
            border: 1px solid var(--dim); padding: 20px; text-align: center; cursor: pointer; 
            background: rgba(0,25,0,0.3); transition: 0.3s;
        }
        .file-card:hover { border-color: var(--neon); background: var(--dim); transform: scale(1.05); }

        /* Overlay Editor */
        #editor-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 200; display: none; flex-direction: column; padding: 30px;
        }
        textarea { flex: 1; background: #050505; color: var(--neon); border: 1px solid var(--neon); padding: 20px; font-size: 1.2rem; }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="btn" onclick="bukaGoogle()">üè† GOOGLE</button>
        
        <input type="text" id="urlInput" placeholder=">> CARI SESUATU DI GOOGLE..." onkeydown="if(event.key==='Enter') jalankanCari()">
        
        <button class="btn" onclick="tampilFiles()">üìÅ BERKAS_LOKAL</button>
        <button class="btn" style="border-color:#f33; color:#f33" onclick="toko.buka_aplikasi_siar('dashboard')">KELUAR</button>
    </div>

    <div class="viewport">
        <div id="file-view">
            <h2 style="border-bottom: 1px solid var(--neon); padding-bottom: 10px;">üìÇ PENJELAJAH_BERKAS</h2>
            <div id="file-list" class="file-grid"></div>
        </div>
    </div>

    <div id="editor-overlay">
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
            <h3 id="edit-title">EDIT_FILE</h3>
            <div style="gap:10px; display:flex;">
                <button class="btn" style="background:var(--neon); color:#000" onclick="simpan()">SIMPAN</button>
                <button class="btn" onclick="tutupEditor()">BATAL</button>
            </div>
        </div>
        <textarea id="text-editor"></textarea>
    </div>

    

    <script>
        let saraf, toko, currentPath = "Dokumen/Siar_Catatan", editingPath = "";

        new QWebChannel(qt.webChannelTransport, function(channel) {
            saraf = channel.objects.berkasSaraf;
            toko = channel.objects.tokoManager;
            muatFiles();
            
            // OTOMATIS: Saat aplikasi dibuka, langsung lempar ke Google jika diinginkan
            // bukaGoogle(); 
        });

        function bukaGoogle() {
            toko.navigasi_langsung("https://www.google.com");
        }

        function jalankanCari() {
            let q = document.getElementById('urlInput').value;
            if(!q) return;
            let url = q.includes('.') ? (q.startsWith('http') ? q : 'https://'+q) : 'https://www.google.com/search?q='+encodeURIComponent(q);
            toko.navigasi_langsung(url);
        }

        function muatFiles() {
            saraf.telusuri_folder(currentPath, function(items) {
                const list = document.getElementById('file-list');
                list.innerHTML = "";
                items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = "file-card";
                    const ikon = item.tipe === 'folder' ? 'üìÅ' : 'üìÑ';
                    card.innerHTML = `<span style="font-size:3rem; display:block; margin-bottom:10px;">${ikon}</span><span>${item.nama}</span>`;
                    card.onclick = () => { if(item.tipe === 'berkas') bukaEditor(item.path_relatif); };
                    list.appendChild(card);
                });
            });
        }

        function bukaEditor(path) {
            editingPath = path;
            saraf.baca_isi_berkas(path, function(isi) {
                document.getElementById('edit-title').innerText = "EDITING: " + path.split('/').pop();
                document.getElementById('text-editor').value = isi;
                document.getElementById('editor-overlay').style.display = 'flex';
            });
        }

        function simpan() {
            saraf.simpan_isi_berkas(editingPath, document.getElementById('text-editor').value, function(s) {
                if(s) alert("Tersimpan!"); tutupEditor();
            });
        }

        function tutupEditor() { document.getElementById('editor-overlay').style.display = 'none'; }
        function tampilFiles() { document.getElementById('file-view').style.display = 'block'; }
    </script>
</body>
</html>
