<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Siar Hacker Navigator V2</title>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <style>
        :root { --neon: #39ff14; --bg: #000; --dim: rgba(57, 255, 20, 0.1); }
        body { 
            background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; 
            margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        /* Bar Navigasi Atas yang Ramping */
        .top-bar { 
            display: flex; gap: 10px; padding: 15px; background: #050505;
            border-bottom: 2px solid var(--neon); align-items: center;
        }

        .btn { 
            background: none; border: 1px solid var(--neon); color: var(--neon); 
            padding: 8px 12px; cursor: pointer; font-family: inherit; font-weight: bold;
        }
        .btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 10px var(--neon); }

        input#urlInput { 
            flex: 1; background: #111; border: 1px solid var(--neon); 
            color: var(--neon); padding: 8px; outline: none;
        }

        /* Dropdown Berkas Lokal */
        select#fileSelect {
            background: #000; color: var(--neon); border: 1px solid var(--neon);
            padding: 8px; font-family: inherit; outline: none; max-width: 200px;
        }

        /* Area Konten Utama */
        .content-area { flex: 1; position: relative; background: #000; }
        
        #editor-view { 
            width: 100%; height: 100%; display: flex; flex-direction: column; 
            padding: 20px; box-sizing: border-box;
        }
        
        textarea { 
            flex: 1; background: #050505; color: var(--neon); border: 1px solid var(--neon); 
            padding: 20px; font-family: inherit; font-size: 1.2rem; outline: none; resize: none;
            line-height: 1.6;
        }

        .status-bar { font-size: 0.8rem; margin-top: 5px; height: 15px; }
        
        #home-logo {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; pointer-events: none;
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="btn" onclick="location.reload()">üè†</button>
        
        <input type="text" id="urlInput" placeholder=">> CARI WEB / MASUKKAN URL..." onkeydown="if(event.key==='Enter') navigasiWeb()">
        
        <select id="fileSelect" onchange="pilihBerkas(this.value)">
            <option value="">üìÇ BUKA_BERKAS...</option>
        </select>

        <button class="btn" onclick="navigasiWeb()">JELAJAHI</button>
        <button class="btn" style="border-color:#f33; color:#f33" onclick="keluar()">KELUAR</button>
    </div>

    <div class="content-area">
        <div id="home-logo">
            <h1 style="letter-spacing: 15px; text-shadow: 0 0 15px var(--neon);">SIAR_NAV_V2</h1>
            <p style="opacity: 0.5;">HACKER_GATEWAY // LOCAL_STORAGE_READY</p>
        </div>

        <div id="editor-view" style="display: none;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <b id="file-title">FILE: -</b>
                <button class="btn" style="padding: 2px 10px; font-size: 0.7rem;" onclick="simpanBerkas()">üíæ SIMPAN PERUBAHAN</button>
            </div>
            <textarea id="text-area"></textarea>
            <div id="save-status" class="status-bar"></div>
        </div>
    </div>

    

    <script>
        let saraf, toko, currentFilePath = "";

        new QWebChannel(qt.webChannelTransport, function(channel) {
            saraf = channel.objects.berkasSaraf; // Saraf Berkas
            toko = channel.objects.tokoManager;  // Otak Pusat
            muatDaftarBerkas("Dokumen/Siar_Catatan");
        });

        function muatDaftarBerkas(path) {
            saraf.telusuri_folder(path, function(items) {
                const select = document.getElementById('fileSelect');
                items.forEach(item => {
                    if(item.tipe === 'berkas') {
                        const opt = document.createElement('option');
                        opt.value = item.path_relatif;
                        opt.innerText = "üìÑ " + item.nama;
                        select.appendChild(opt);
                    }
                });
            });
        }

        function pilihBerkas(path) {
            if(!path) return;
            currentFilePath = path;
            saraf.baca_isi_berkas(path, function(isi) {
                document.getElementById('home-logo').style.display = 'none';
                document.getElementById('editor-view').style.display = 'flex';
                document.getElementById('file-title').innerText = "FILE: " + path.split('/').pop();
                document.getElementById('text-area').value = isi;
                document.getElementById('save-status').innerText = "";
            });
        }

        function simpanBerkas() {
            const konten = document.getElementById('text-area').value;
            const status = document.getElementById('save-status');
            status.innerText = "‚è≥ Menyimpan ke sistem...";
            
            saraf.simpan_isi_berkas(currentFilePath, konten, function(sukses) {
                if(sukses) {
                    status.innerText = "‚úÖ PERUBAHAN TERSIMPAN PERMANEN";
                    setTimeout(() => { status.innerText = ""; }, 3000);
                } else {
                    status.innerText = "‚ùå GAGAL MENYIMPAN!";
                }
            });
        }

        function navigasiWeb() {
            let query = document.getElementById('urlInput').value;
            if(!query) return;

            let url = query;
            if(!query.includes('.') && !query.startsWith('http')) {
                url = "https://www.google.com/search?q=" + encodeURIComponent(query);
            } else if (!query.startsWith('http')) {
                url = "https://" + query;
            }

            // Pindah navigasi langsung di otak.py untuk hindari blokir
            toko.navigasi_langsung(url);
        }

        function keluar() { toko.buka_aplikasi_siar('dashboard'); }
    </script>
</body>
</html>
